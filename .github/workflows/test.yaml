name: Run Da Tests

on:
  push:
    branches:
      - $default-branch
      - fix-some-warnings
  pull_request:
    branches:
      - $default-branch

jobs:
  test:
    runs-on: ubuntu-latest
    name: OTP ${{matrix.otp}}
    strategy:
      matrix:
        otp: [24.0.2] # 22.3.4.9, 23.3.1,
        emacs: [27.1] # 24.5, 26.3,

    steps:
      # - name: Install Emacs
      #   uses: purcell/setup-emacs@master
      #   with:
      #     version: ${{matrix.emacs}}

      - name: Install Erlang
        id: install_erlang
        uses: gleam-lang/setup-erlang@v1.1.2
        with:
          otp-version: ${{matrix.otp}}
        run: echo '::set-output name=ERL_PATH::$ERL_PATH'

      - name: Test erlang
        run: which erl

      - name: Print env
        run: |
          echo "GITHUB_ENV=$ENV"
          echo "install_erlang_erl_path=${{ steps.install_erlang.outputs.ERL_PATH }}"
          echo "install_erlang_env=${{ steps.install_erlang.env }}"


      # - name: Add Erlang to Path
      #   run: |
      #     echo "${{ steps.install_erlang.outputs.erlpath }}/bin" >> $GITHUB_PATH
      #     echo "ERL_PATH=${{ steps.install_erlang.outputs.erlpath }}" >> $GITHUB_ENV

      # - name: Checkout
      #   uses: actions/checkout@v2
      #   with:
      #     submodules: true

      # - name: Compile
      #   run: |
      #     echo "ERLPATH=${{ env.ERL_PATH }}"
      #     make

      # - name: Test
      #   run: make test
